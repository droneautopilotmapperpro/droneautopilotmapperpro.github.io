<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Okto Drone Autopilot Mapper Pro V.8.2</title>
  <style>
    :root{
      --bg:#070707;
      --gold:#b8860b; /* dark gold */
      --gold-soft:#c9a84a;
      --accent-green:#28c76f; /* text color (green) */
      --text:#dcdcdc;
      --glass: rgba(255,255,255,0.03);
      --glass-2: rgba(255,255,255,0.02);
      --max-w:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}

    /* Background overlay + subtle pattern (replace --bg-image with your Unsplash image url) */
    .page-bg{
      position:fixed;inset:0;z-index:-2;pointer-events:none;background-color:var(--bg);
      background-image: radial-gradient(rgba(184,134,11,0.06) 0.5px, transparent 0.5px), linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.7));
      background-size:12px 12px, cover;
      filter: saturate(0.9) contrast(1.02);
    }
    /* gradient band (gold shimmer) */
    .gold-shimmer{position:fixed;inset: -20% -50% auto -50%;height:60vh;transform:rotate(-12deg);background:linear-gradient(90deg, rgba(184,134,11,0.03), rgba(255,215,0,0.06) 40%, rgba(184,134,11,0.04));mix-blend-mode:overlay;z-index:-1;}

    .container{max-width:var(--max-w);margin:0 auto;padding:5px 20px}
    header{display:flex;align-items:center;justify-content:space-between;padding:5px 0;position:sticky;top:0;background:linear-gradient(180deg, rgba(7,7,7,0.45), rgba(7,7,7,0.2));backdrop-filter: blur(6px);z-index:40;border-bottom:1px solid rgba(255,255,255,0.03)}
    .logo{display:flex;align-items:center;gap:12px}
    .logo .mark{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--gold),var(--gold-soft));box-shadow:0 6px 18px rgba(184,134,11,0.12);display:grid;place-items:center;font-weight:700;color:#090909}
    nav{display:flex;gap:18px;align-items:center}
    nav a{position:relative;padding:10px 8px;border-radius:6px;color:var(--accent-green);text-decoration:none;font-weight:600;transition: color .18s ease, transform .18s ease}
    nav a:hover{color:#ffffff}
    /* animated underline */
    nav a::after{content:'';position:absolute;left:8px;right:8px;bottom:6px;height:2px;background:linear-gradient(90deg,var(--gold),var(--gold-soft));opacity:0;transform:scaleX(0);transform-origin:left center;transition:transform .32s cubic-bezier(.2,.9,.2,1),opacity .28s}
    nav a:hover::after{opacity:1;transform:scaleX(1)}

    /* header buttons */
    .cta{margin-left:12px;padding:8px 12px;border-radius:8px;background:linear-gradient(90deg,var(--gold),var(--gold-soft));color:#070707;font-weight:700;box-shadow:0 6px 18px rgba(184,134,11,0.12)}

    /* Hero */
    .hero{min-height:78vh;display:grid;align-items:center;padding:1px 0}
    .hero-grid{display:grid;grid-template-columns:1fr 420px;gap:40px;align-items:center}
    .title{font-size:clamp(25px,6.2vw,35px);line-height:1.02;margin:0 0 10px}
    .lead{color:rgba(220,220,220,0.85);margin-bottom:20px}
    .green-link{color:var(--accent-green);text-decoration:none;font-weight:700}
    .green-link:hover{color:#ffffff}

    /* hero card */
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);padding:20px;border-radius:14px}

    /* Donation */
    .donation{display:flex;flex-direction:column;gap:14px}
    .progress{height:16px;background:var(--glass);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;width:58%;background:linear-gradient(90deg,var(--gold),var(--gold-soft));box-shadow:inset 0 -6px 12px rgba(0,0,0,0.25);transition:width 1s ease}

    /* cards */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .news-card{padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);min-height:180px;display:flex;flex-direction:column;gap:12px}

    /* tutorial */
    .steps{display:flex;flex-direction:column;gap:12px}
    .step{display:flex;gap:16px;align-items:flex-start;padding:14px;border-radius:10px;background:var(--glass-2);border:1px solid rgba(255,255,255,0.02)}
    .code{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(255,255,255,0.01));padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);overflow:auto}

    /* about */
    .team{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .member{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.15));border:1px solid rgba(255,255,255,0.03);text-align:center;transition:transform .45s cubic-bezier(.2,.9,.2,1),box-shadow .3s}
    .member:hover{transform:translateY(-12px) rotate(-1deg);box-shadow:0 30px 60px rgba(0,0,0,0.6)}

    /* reveal animations */
    .reveal{opacity:0;transform:translateY(18px);transition:opacity .8s ease, transform .8s cubic-bezier(.2,.9,.2,1)}
    .reveal.is-visible{opacity:1;transform:none}

    /* small screens */
    @media (max-width:900px){
      .hero-grid{grid-template-columns:1fr;}
      .grid,.team{grid-template-columns:1fr}
      nav{display:none}
    }

    /* small micro animations */
    @keyframes floaty{0%{transform:translateY(0)}50%{transform:translateY(-8px)}100%{transform:translateY(0)}}
    .float{animation:floaty 6s ease-in-out infinite}

    /* ================= Audio control (pojok kanan bawah) ================= */
    .audio-control{
      position:fixed;
      right:20px;
      bottom:20px;
      width:64px;
      height:64px;
      border-radius:12px;
      display:grid;
      place-items:center;
      z-index:200;
      background:linear-gradient(180deg,var(--gold),var(--gold-soft));
      box-shadow:0 10px 30px rgba(184,134,11,0.18);
      cursor:pointer;
      transition:transform .18s ease,box-shadow .18s ease;
      border:1px solid rgba(255,255,255,0.06);
    }
    .audio-control:active{ transform:scale(.98); }
    .audio-control .icon{ width:28px; height:28px; display:block; fill:#070707; }
    .audio-control.playing{ box-shadow:0 18px 40px rgba(184,134,11,0.28); animation:audio-pulse 1.6s ease-in-out infinite; }
    @keyframes audio-pulse{ 0%{transform:scale(1)} 50%{transform:scale(1.04)} 100%{transform:scale(1)} }

    /* hint jika autoplay diblokir */
    .audio-hint{
      position:fixed;
      right:20px;
      bottom:94px;
      background:rgba(0,0,0,0.6);
      padding:8px 10px;
      border-radius:8px;
      color:rgba(255,255,255,0.9);
      font-size:13px;
      z-index:210;
      display:none;
    }

    /* kelas untuk teks yang akan sedikit bergerak mengikuti musik */
    .reactive{ will-change:transform; display:inline-block; transition:transform .16s linear; }

  </style>
</head>
<body>
  <div class="page-bg" aria-hidden="true"></div>
  <div class="gold-shimmer" aria-hidden="true"></div>

  <!-- AUDIO (ganti src dengan file audio kamu) -->
  <audio id="bg-audio" crossorigin="anonymous" playsinline loop preload="auto" src="bgm.mp3"></audio>

  <header class="container">
    <div class="logo">
      <div class="mark">V.8.2</div>
      <div>
        <div style="font-weight:700;letter-spacing:0.6px">  Okto Drone Autopilot Mapper Pro</div>
        <div style="font-size:12px;color:rgba(255,255,255,0.35)">  Profesional & Easy To Use</div>
      </div>
    </div>
    <nav role="navigation" aria-label="Main navigation">
      <a href="#home">Home</a>
      <a href="#donation">Donation</a>
      <a href="#news">News</a>
      <a href="#tutorial">Tutorial</a>
      <a href="#about">About</a>
      <a class="cta" href="#donation">Donate</a>
    </nav>
  </header>

  <main class="container">
    <section id="home" class="hero">
      <div class="hero-grid">
        <div>
          <h1 class="font-size:10px;title reveal">Thanks For Buying <span style="font-size:35px;background:linear-gradient(90deg,var(--gold),var(--gold-soft));-webkit-background-clip:text;background-clip:text;color:transparent">Drone Autopilot Mapper Pro V.8.2</span><br> You Can Support Me by Donating through this QR Code </h1>
          <div class="reveal" style="display:flex;gap:18px;align-items:center;margin-top:18px">
            <figure class="card" style="margin:0;max-width:320px;padding:5px;flex-shrink:0">
              <img src="QROkto.jpeg" alt="QR code donasi" style="width:100%;height:auto;border-radius:8px;display:block" loading="lazy" />
              <figcaption style="margin-top:8px;font-size:13px;color:rgba(255,255,255,0.7)">Scan QR untuk donasi</figcaption>
            </figure>

            <div style="color:rgba(255,255,255,0.85);max-width:560px">
              <p style="margin:0 0 8px">Terimakasih Donasi Sahabat dan Telah Menghargai Kerja Keras Saya Dalam Membangun Aplikasi Ini ðŸ‘‹ðŸ¥°</p>
              <p style="margin:0"><a class="green-link" href="#donation">Nama Sahabat akan Muncul Disini â†’</a></p>
            </div>
          </div>
          <p class="lead reveal">Here's List of <a class="green-link" href="#">The Great People</a> Which have Donating Me and Supporting Me , Thankyou It Means alot!!(Saya Akan Terus Mengembangkan Software Ini ðŸš€ðŸš€)</p>
          <div style="display:flex;gap:5px;align-items:center" class="reveal">
            <a class="cta" href="#donation">The Great People</a>
            <a class="green-link" href="#tutorial">Software Tutorial â†’</a>
          </div>
          <div style="margin-top:15px" class="card reveal">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-size:12px;color:rgba(255,255,255,0.6)">Target User Download</div>
                <div style="font-weight:700;font-size:20px">10.000</div>
              </div>
              <div style="text-align:right">
                <div style="font-size:12px;color:rgba(255,255,255,0.6)">Download</div>
                <div style="font-weight:700;font-size:20px;color:var(--accent-green)">0</div>
              </div>
            </div>
            <div style="margin-top:14px">
              <div class="progress" aria-hidden="true"><i style="width:0%"></i></div>
            </div>
          </div>
        </div>

        <aside>
          <div class="card float reveal">
            <h3 style="margin:0 0 10px">Why choose this style?</h3>
            <p style="margin:0 0 12px;color:rgba(255,255,255,0.65)">Black + gold memberi kesan premium. Gunakan rantai warna yang hangat untuk aksen, dan hijau sebagai highlight interaksi (CTA hover â†’ putih).</p>
            <div style="display:flex;gap:8px;margin-top:6px">
              <button class="cta">Join</button>
              <button style="padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;font-weight:700;color:var(--accent-green)" onclick="scrollTo('#news')">Latest News</button>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <section id="donation" style="padding:40px 0">
      <h2 class="reveal">Donation</h2>
      <div class="donation reveal" style="margin-top:18px;">
        <div style="display:flex;gap:18px;align-items:center;flex-wrap:wrap">
          <div style="flex:1;min-width:240px" class="card">
            <div style="font-size:13px;color:rgba(255,255,255,0.6)">Progress</div>
            <div style="margin-top:10px" class="progress"><i style="width:58%"></i></div>
            <div style="margin-top:10px;display:flex;justify-content:space-between;color:rgba(255,255,255,0.6)"><span>58% tercapai</span><span>29M/50M</span></div>
          </div>

          <div style="flex:1;min-width:240px" class="card">
            <div style="font-weight:700">Pilih Paket</div>
            <div style="display:flex;gap:8px;margin-top:10px">
              <button style="padding:10px;border-radius:10px;background:transparent;border:1px dashed rgba(255,255,255,0.06);min-width:100px">Rp 50.000</button>
              <button style="padding:10px;border-radius:10px;background:linear-gradient(90deg,var(--gold),var(--gold-soft));color:#070707;min-width:100px">Rp 150.000</button>
              <button style="padding:10px;border-radius:10px;background:transparent;border:1px dashed rgba(255,255,255,0.06);min-width:100px">Custom</button>
            </div>
          </div>

          <div style="min-width:200px" class="card">
            <div style="font-weight:700">Tindakan Cepat</div>
            <div style="margin-top:12px;display:flex;gap:8px;flex-direction:column">
              <button class="cta">Donasi Sekarang</button>
              <button style="padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04)">Lihat Laporan</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="news" style="padding:40px 0">
      <h2 class="reveal">News</h2>
      <div class="grid" style="margin-top:18px">
        <article class="news-card reveal">
          <div style="height:120px;border-radius:8px;background:linear-gradient(180deg, rgba(184,134,11,0.12), rgba(0,0,0,0.3));display:grid;place-items:center;font-weight:700">Feature Image</div>
          <div style="flex:1">
            <h3 style="margin:0 0 8px">Launch: New Module</h3>
            <p style="margin:0;color:rgba(255,255,255,0.6)">Keterangan singkat tentang modul terbaru dengan highlight interaktif.</p>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;color:rgba(255,255,255,0.5)"><span>Nov 23, 2025</span><a class="green-link" href="#">Read â†’</a></div>
        </article>

        <article class="news-card reveal">
          <div style="height:120px;border-radius:8px;background:linear-gradient(180deg, rgba(184,134,11,0.12), rgba(0,0,0,0.3));display:grid;place-items:center;font-weight:700">Image</div>
          <h3 style="margin:0">Design showcase</h3>
          <p style="color:rgba(255,255,255,0.6)">Contoh kombinasi layout dan micro-interactions untuk landing page.
          </p>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;color:rgba(255,255,255,0.5)"><span>Nov 13, 2025</span><a class="green-link" href="#">Read â†’</a></div>
        </article>

        <article class="news-card reveal">
          <div style="height:120px;border-radius:8px;background:linear-gradient(180deg, rgba(184,134,11,0.12), rgba(0,0,0,0.3));display:grid;place-items:center;font-weight:700">Image</div>
          <h3 style="margin:0">Community update</h3>
          <p style="color:rgba(255,255,255,0.6)">Ringkasan aktivitas komunitas dan inisiatif baru.</p>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;color:rgba(255,255,255,0.5)"><span>Oct 30, 2025</span><a class="green-link" href="#">Read â†’</a></div>
        </article>
      </div>
    </section>

    <section id="tutorial" style="padding:40px 0">
      <h2 class="reveal">Tutorial</h2>
      <div class="steps" style="margin-top:18px">
        <div class="step reveal">
          <div style="width:48px;height:48px;border-radius:10px;background:linear-gradient(90deg,var(--gold),var(--gold-soft));display:grid;place-items:center;font-weight:700;color:#070707">1</div>
          <div>
            <div style="font-weight:700">Setup project</div>
            <div style="color:rgba(255,255,255,0.6);margin-top:6px">Buat struktur file, siapkan variabel warna, dan tambahkan background pattern.</div>
            <div style="margin-top:8px" class="code"><pre style="margin:0;font-size:13px">&lt;link rel="stylesheet" href="style.css"/&gt;</pre></div>
          </div>
        </div>

        <div class="step reveal">
          <div style="width:48px;height:48px;border-radius:10px;background:linear-gradient(90deg,var(--gold),var(--gold-soft));display:grid;place-items:center;font-weight:700;color:#070707">2</div>
          <div>
            <div style="font-weight:700">Micro interactions</div>
            <div style="color:rgba(255,255,255,0.6);margin-top:6px">Gunakan transitions, animated underline, dan reveal on scroll untuk memperkaya pengalaman.</div>
          </div>
        </div>
      </div>
    </section>

    <section id="about" style="padding:40px 0">
      <h2 class="reveal">About</h2>
      <div class="team" style="margin-top:18px">
        <div class="member reveal">
          <div style="font-size:20px;font-weight:700;color:#b8860b">Mapping Solution</div>
          <div style="color:rgba(255,255,255,0.6);margin-top:8px">Create Drone Wayline with Front Overlap , Side Overlap and Precision Coordinate</div>
        </div>
        <div class="member reveal">
          <div style="font-size:20px;font-weight:700;color:#b8860b">Speed Orientation</div>
          <div style="color:rgba(255,255,255,0.6);margin-top:8px">With Both Mathematics and Physics Algorithm , Can Provide Max Speed @ 14 m/s mapping</div>
        </div>
        <div class="member reveal">
          <div style="font-size:20px;font-weight:700;color:#b8860b">Horizontal and Vertical Wayline</div>
          <div style="color:rgba(255,255,255,0.6);margin-top:8px">Plan Horizontal or Vertical Lines waypoint for effectiveness Mapping with Your Drone </div>
        </div>
      </div>
    </section>

    <div id="audio-hint" class="audio-hint" role="status" aria-live="polite">
      Klik tombol musik untuk menyalakan suara
    </div>

    <button id="audio-control" class="audio-control" aria-pressed="false" aria-label="Play background music">
      <!-- play/pause SVG icon (tukar display untuk play/pause via JS) -->
      <svg id="audio-icon" class="icon" viewBox="0 0 24 24" aria-hidden="true">
        <path id="play-path" d="M8 5v14l11-7z"></path>
        <g id="pause-path" style="display:none">
          <path d="M6 5h4v14H6z"></path>
          <path d="M14 5h4v14h-4z"></path>
        </g>
      </svg>
    </button>


    <footer style="padding:40px 0;color:rgba(255,255,255,0.45);text-align:center">Â© 2025 Drone Autopilot Mapper Pro V.8.2 â€” Crafted By Okto</footer>
  </main>

  <script>
    // Smooth scroll for header buttons
    function scrollTo(sel){document.querySelector(sel).scrollIntoView({behavior:'smooth',block:'start'})}

    // Reveal on scroll
    const reveals = document.querySelectorAll('.reveal');
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting) e.target.classList.add('is-visible');
      });
    },{threshold:0.12});
    reveals.forEach(r=>io.observe(r));

    // tiny parallax effect for background shimmer
    const shimmer = document.querySelector('.gold-shimmer');
    window.addEventListener('scroll',()=>{
      const y = window.scrollY;
      shimmer.style.transform = `translateY(${y*0.05}px) rotate(-12deg)`;
    });

    // keyboard accessibility: jump to sections with number keys (1..5)
    window.addEventListener('keydown', (e)=>{
      if(/^[1-5]$/.test(e.key)){
        const map = ['#home','#donation','#news','#tutorial','#about'];
        document.querySelector(map[Number(e.key)-1]).scrollIntoView({behavior:'smooth'});
      }
    });

    /* ================= Audio + Reactive Text (paste di akhir <script> atau buat script baru) ================= */
    (function(){
      const audioEl = document.getElementById('bg-audio');
      const controlBtn = document.getElementById('audio-control');
      const audioHint = document.getElementById('audio-hint');

      let audioCtx = null;
      let sourceNode = null;
      let analyser = null;
      let rafId = null;
      let reactiveEls = [];
      let elPhases = [];

      // Adjustable parameters:
      const MAX_Y = 3;       // max translate in px (subtle). ubah ke 2 atau 4 sesuai selera
      const MAX_ROT = 0.6;   // max rotation in degrees
      const SMOOTH = 0.12;   // smoothing factor (0..1)
      const FFT_SIZE = 256;  // analyser FFT size (256 atau 512)

      // Collect text elements to animate
      function collectReactiveElements(){
        reactiveEls = [];
        elPhases = [];
        // pilih elemen teks umum â€” ubah selector jika mau lebih spesifik
        const candidates = document.querySelectorAll('h1,h2,h3,h4,h5,h6,p,a,button,span,label,li,small');
        candidates.forEach(el=>{
          const txt = (el.textContent || '').trim();
          if(!txt) return;
          if(el.offsetParent === null) return; // hidden element
          if(txt.length > 800) return; // skip very long container text
          if(el.closest('#audio-control')) return; // jangan include kontrol
          el.classList.add('reactive');
          reactiveEls.push(el);
          elPhases.push(Math.random()*Math.PI*2);
          el._prevY = 0;
        });
      }

      // Setup audio context + analyser
      function setupAudioContext(){
        if(!window.AudioContext && !window.webkitAudioContext) return false;
        try{
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          sourceNode = audioCtx.createMediaElementSource(audioEl);
          analyser = audioCtx.createAnalyser();
          analyser.fftSize = FFT_SIZE;
          analyser.smoothingTimeConstant = 0.7;
          sourceNode.connect(analyser);
          analyser.connect(audioCtx.destination);
          return true;
        }catch(e){
          console.warn('AudioContext setup failed:', e);
          return false;
        }
      }

      // Start visual animation loop (uses analyser data)
      function startAnimationLoop(){
        if(!analyser) return;
        const freqData = new Uint8Array(analyser.frequencyBinCount);
        const startTime = performance.now();
        function frame(){
          analyser.getByteFrequencyData(freqData);
          // focus on low-frequency energy (bass/beat) for subtle movement
          const lowCount = Math.max(8, Math.floor(freqData.length * 0.12));
          let sumLow = 0;
          for(let i=0;i<lowCount;i++) sumLow += freqData[i];
          const avg = sumLow / lowCount; // 0..255
          const norm = avg / 255; // 0..1
          const time = performance.now() - startTime;

          reactiveEls.forEach((el, idx)=>{
            const phase = elPhases[idx];
            const oscill = Math.sin(time * 0.004 + phase);
            const amp = norm * (0.8 + 0.4 * Math.sin(phase*0.23 + time*0.0009));
            let y = oscill * amp * MAX_Y;
            let r = Math.cos(time*0.001 + phase) * amp * MAX_ROT;
            y = el._prevY * (1 - SMOOTH) + y * SMOOTH;
            el._prevY = y;
            el.style.transform = `translate3d(0, ${y.toFixed(2)}px, 0) rotate(${r.toFixed(2)}deg)`;
          });

          rafId = requestAnimationFrame(frame);
        }
        frame();
      }

      function stopAnimationLoop(){
        if(rafId) cancelAnimationFrame(rafId);
        rafId = null;
        // reset transforms
        reactiveEls.forEach(el=>{
          el.style.transform = '';
        });
      }

      async function toggleAudio(){
      try{
        if(!audioCtx){
          setupAudioContext();
        }
        if(audioCtx && audioCtx.state === 'suspended'){
          await audioCtx.resume();
        }

        if(audioEl.paused){
          // jika sebelumnya autoplay muted dijalankan, audio mungkin paused==false but muted==true.
          // pastikan kita unmute untuk suara
          if(audioEl.muted){
            audioEl.muted = false;
            await audioEl.play().catch(()=>{}); // play kalau perlu
            fadeInVolume(audioEl, 0.5, 600);
          } else {
            await audioEl.play();
          }
          controlBtn.classList.add('playing');
          controlBtn.setAttribute('aria-pressed','true');
        } else {
          audioEl.pause();
          controlBtn.classList.remove('playing');
          controlBtn.setAttribute('aria-pressed','false');
        }
      }catch(err){
        console.warn('toggleAudio error', err);
        audioHint.style.display = 'block';
        setTimeout(()=> audioHint.style.display = 'none', 2500);
      }
    }

      function setControlIconPlaying(isPlaying){
        const playPath = document.getElementById('play-path');
        const pauseGroup = document.getElementById('pause-path');
        if(isPlaying){
          if(playPath) playPath.style.display = 'none';
          if(pauseGroup) pauseGroup.style.display = 'inline';
        }else{
          if(playPath) playPath.style.display = 'inline';
          if(pauseGroup) pauseGroup.style.display = 'none';
        }
      }

      // Events
      audioEl.addEventListener('play', ()=>{
        setControlIconPlaying(true);
        if(!audioCtx) setupAudioContext();
        if(!rafId) startAnimationLoop();
      });
      audioEl.addEventListener('pause', ()=>{
        setControlIconPlaying(false);
        stopAnimationLoop();
      });

      controlBtn.addEventListener('click', async (e)=>{
        e.preventDefault();
        await toggleAudio();
        audioHint.style.display = 'none';
      });
      // keyboard activation
      controlBtn.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); controlBtn.click(); }
      });

      // fade-in helper: panggil fadeInVolume(audioEl, 0.6, 700);
      function fadeInVolume(audio, target = 0.6, duration = 700) {
        try {
          audio.volume = audio.volume ?? 0;
          const start = performance.now();
          const initial = audio.volume;
          function step(now) {
            const t = Math.min((now - start) / duration, 1);
            audio.volume = initial + (target - initial) * t;
            if (t < 1) requestAnimationFrame(step);
          }
          requestAnimationFrame(step);
        } catch (e) { /* ignore */ }
      }

     
      // fungsi autoplay
      async function tryAutoPlay(){
        collectReactiveElements();
        try{ setupAudioContext(); }catch(e){}

        // Helper: action yang dieksekusi sekali pada gesture user (unmute + fade + play)
        async function handleUserGestureOnce() {
          try {
            // resume AudioContext jika perlu
            if (audioCtx && audioCtx.state === 'suspended') {
              await audioCtx.resume();
            }
            // unmute & fade-in
            if (audioEl.muted) audioEl.muted = false;
            // pastikan play (beberapa browser mempause saat muted->unmuted)
            try { await audioEl.play(); } catch(_) {}
            fadeInVolume(audioEl, 0.6, 600);
            controlBtn.classList.add('playing');
            controlBtn.setAttribute('aria-pressed','true');
            // start visualizer jika belum
            if(!rafId && analyser) startAnimationLoop();
          } catch(err) {
            console.warn('handleUserGestureOnce error', err);
          } finally {
            // remove all gesture listeners (safety)
            window.removeEventListener('pointerdown', gestureListener);
            window.removeEventListener('keydown', gestureListener);
            window.removeEventListener('touchstart', gestureListener);
            window.removeEventListener('pointerover', gestureListener);
            window.removeEventListener('scroll', scrollListener);
          }
        }

        // generic listener wrapper
        const gestureListener = function(e){
          // small debounce â€” if user triggered multiple events quickly, ignore duplicates
          if (gestureListener._fired) return;
          gestureListener._fired = true;
          handleUserGestureOnce();
        };

        // scroll needs its own to remove after first use (can't use {once:true} reliably cross-browser)
        const scrollListener = function(e){
          if (scrollListener._fired) return;
          scrollListener._fired = true;
          handleUserGestureOnce();
        };

        try{
          audioEl.loop = true;
          audioEl.preload = 'auto';

          // Try muted autoplay first (most browsers permit muted autoplay)
          audioEl.muted = true;
          audioEl.volume = 0;

          await audioEl.play(); // coba play muted
          // berhasil autoplay (muted)
          if(!audioCtx) setupAudioContext();
          if(analyser) startAnimationLoop();

          controlBtn.classList.add('playing');
          controlBtn.setAttribute('aria-pressed','true');

          // Pasang listeners agar scroll atau hover juga menjadi trigger "unmute"
          window.addEventListener('pointerdown', gestureListener, {passive:true});
          window.addEventListener('keydown', gestureListener, {passive:true});
          window.addEventListener('touchstart', gestureListener, {passive:true});
          window.addEventListener('pointerover', gestureListener, {passive:true});
          window.addEventListener('scroll', scrollListener, {passive:true});

        }catch(err){
          // autoplay muted gagal (jarang), fallback: tampilkan hint & tunggu gesture
          controlBtn.classList.remove('playing');
          controlBtn.setAttribute('aria-pressed','false');
          audioHint.style.display = 'block';
          setTimeout(()=> audioHint.style.display = 'none', 2400);

          // pasang same gesture listeners untuk memulai play+unmute ketika user scroll/hover/click
          window.addEventListener('pointerdown', gestureListener, {passive:true});
          window.addEventListener('keydown', gestureListener, {passive:true});
          window.addEventListener('touchstart', gestureListener, {passive:true});
          window.addEventListener('pointerover', gestureListener, {passive:true});
          window.addEventListener('scroll', scrollListener, {passive:true});
        }
      }
      // Start
      tryAutoPlay();
    })();


  </script>
</body>
</html>
